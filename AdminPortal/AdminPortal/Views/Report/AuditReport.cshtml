@model IEnumerable<AuditReport>

@{
    Layout = null;
}
@section Scripts{
    @* DATATABLE scripts implementation *@
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Latest compiled and minified CSS -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="~/styles/report.css">
    <title>Admin Panel</title>

</head>
<body>
    <h1>Audit Report</h1>
    <table id="datatable" class="table table-bordered">
        <thead class="blue-background">
            <tr>
                <th>Admin</th>
                <th>Action</th>
                <th>Target</th>
                <th>DateTime</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.AdminName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Action)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Target)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CreatedAt)
                    </td>
                </tr>
            }
        </tbody>
    </table>
</body>
</html>

<script>
    var report = localStorage.getItem("report");
    var startDate = localStorage.getItem("startDate");
    var endDate = localStorage.getItem("endDate");

    var url = "/Report/MilestoneReport?ReportType=" + report + "&StartDate=" + startDate + "&EndDate=" + endDate;
    $(document).ready(function () {
        var oTable =
            $('#datatable').DataTable({
                "pageLength": 4,
                "lengthChange": false,
                "sDom": 'ltipr',
            });

        loadData();
        function loadData() {
            //Note: jQuery.ajax(..) is also often written is $.ajax(..)
            var $loadhandler = jQuery.ajax({
                type: 'GET',
                url: url,
                dataType: 'json',
                contentType: "application/json"
            });


            $loadDataHandler.done(function (data, textStatus, jqXHR) {
                //This done method will
                //The (data) input parameter automatically captures the response from the
                //Get() API method which is labelled to handle this GET request.

                //I usually use the following code to inspect the returned result captured by the data input parameter from the web server.
                console.log(data);

                $(document).ready(function () {

                    var t = $('#datatable').DataTable({
                    });
                    t.on('order.dt search.dt', function () {
                        t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                            cell.innerHTML = i + 1;
                        });
                    }).draw();

                });
                //After inspecting the data object with the console.log
                //I have clear picture of the structure and used the following variable to represent the response.
                //var rewardList = data;
                //var Admin = '';
                //var Action = '';
                //var DateTime = '';
                //var Target = '';
                //var $tableElement = null;
                //var $cellElement = null;
                //var $rowElement = null;
                //$tableBodyElement = $('#tableBody');

                //for (index = 0; index < rewardList.length; index++) {
                //    rewardList = rewardList[index];

                //    Admin = rewardList.AdminName;
                //    Action = rewardList.Action;
                //    DateTime = rewardList.DateTimeReceived;


                //    $rowElement = $('<tr></tr>');
                //    $cellElement = $('<td></td>');

                //    $cellElement = $('<td></td>', { text: Admin });
                //    $rowElement.append($cellElement);

                //    $cellElement = $('<td></td>', { text: Action });
                //    $rowElement.append($cellElement);

                //    $cellElement = $('<td></td>', { text: DateTime });
                //    $rowElement.append($cellElement);

                //    $cellElement = $('<td></td>', { text: Target });
                //    $rowElement.append($cellElement);


                //    $tableBodyElement.append($rowElement);
            }

            //end of for loop.
        }//end of JavaScript anonymous function
        )//end of the done() method;
    $loadDataHandler.fail(function (data, textStatus, jqXHR) {
        new Noty({
            text: 'Ajax call has failed due to : ' + data.statusText, type: 'error',
            layout: 'center'
        }).show();//end of noty()
    })//end of $loadDataHandler.fail()
    }//end of $loadDataHandler();
</script>
